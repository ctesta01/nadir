<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Screeners • nadir</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Screeners">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nadir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Basic-Examples.html">Basic Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Benchmarking.html">Benchmarking Against `{SuperLearner}` and `{sl3}`</a></li>
    <li><a class="dropdown-item" href="../articles/Binary-and-Multiclass-Outcomes.html">Binary and Multiclass Outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/Clustered-Data.html">Clustered and Dependent Data</a></li>
    <li><a class="dropdown-item" href="../articles/comparison_to_SuperLearner.html">Comparison to `{SuperLearner}` and `{sl3}`</a></li>
    <li><a class="dropdown-item" href="../articles/Creating-Learners.html">Creating Learners</a></li>
    <li><a class="dropdown-item" href="../articles/currying_closures_and_function_factories.html">Currying, Closures, and Function Factories</a></li>
    <li><a class="dropdown-item" href="../articles/Density-Estimation.html">Density Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Doubly-Robust-Estimation.html">Doubly Robust Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Error-Handling.html">Error Handling</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><a class="dropdown-item" href="../articles/Guidance-for-Developers.html">Guidance for Developers</a></li>
    <li><a class="dropdown-item" href="../articles/Running-super_learner-in-Parallel.html">Running `super_learner()` in Parallel</a></li>
    <li><a class="dropdown-item" href="../articles/Screeners.html">Screeners</a></li>
    <li><a class="dropdown-item" href="../articles/Survival.html">Survival Analysis via Pooled Logistic Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Using-Weights.html">Using Observation Weights</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizing-Performance.html">Visualizing Performance</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ctesta01/nadir/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Screeners</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctesta01/nadir/blob/HEAD/vignettes/articles/Screeners.Rmd" class="external-link"><code>vignettes/articles/Screeners.Rmd</code></a></small>
      <div class="d-none name"><code>Screeners.Rmd</code></div>
    </div>

    
    
<p>There are several reasons one may want to screen out predictor
variables from a regression problem being passed to
<code><a href="../reference/super_learner.html">nadir::super_learner()</a></code>:</p>
<ul>
<li>A more parsimonious model that excludes candidate predictor
variables that have no explanatory value may have better predictive
performance,</li>
<li>
<code><a href="../reference/super_learner.html">nadir::super_learner()</a></code> can be a computationally
expensive algorithm, so removing extraneous predictor variables with
little-to-no predictive value can reduce runtime</li>
<li>Including learners that reflect a variety of different thresholds
for screening out variables can enrich the set of candidate learners,
making it more likely that the true data generating process is
accurately reflected by one of the trained learners.</li>
</ul>
<p>We view screening out variables as potentially occurring in either of
two settings: 1) before the regression problem is specified, or 2) on a
per-learner basis.</p>
<p>When using the <a href="https://ctesta01.github.io/nadir/">nadir</a> package in R/RStudio, the
<code><a href="../reference/screeners.html">?screeners</a></code> documentation is available for reference.</p>
<div class="section level2">
<h2 id="screening-variables-out-of-the-regression-problem">Screening Variables out of the Regression Problem<a class="anchor" aria-label="anchor" href="#screening-variables-out-of-the-regression-problem"></a>
</h2>
<p>The screeners currently available in <a href="https://ctesta01.github.io/nadir/">nadir</a> are:</p>
<ul>
<li>
<code>screener_cor</code> — thresholds based on the correlation
coefficient.</li>
<li>
<code>screener_cor_top_n</code> — only keeps the top n predictors
most correlated with the outcome.</li>
<li>
<code>screener_t_test</code> — uses the t statistic or p.value from
a linear model of the outcome, intercept, and one predictor at a
time.</li>
</ul>
<p>In order to use these to set up our regression problem, we can follow
the following template:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctesta01.github.io/nadir/">nadir</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># step 1:</span></span>
<span><span class="co"># specify the original regression problem, before any screening has been done</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># data:    will be the mtcars dataset </span></span>
<span><span class="co"># formula: will be mpg ~ . </span></span>
<span><span class="co">#   as in, mpg regressed on every other column.</span></span>
<span><span class="co"># </span></span>
<span></span>
<span><span class="co"># step 2: </span></span>
<span><span class="co"># use a screener to modify the problem, dropping some predictors </span></span>
<span><span class="va">screened_regression_problem</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/screener_cor.html">screener_cor</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>, </span>
<span>  formula <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co"># we will require predictors have correlation coefficient of at least 0.5 to keep them</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># if you want to look, you can see what was kept:</span></span>
<span><span class="va">screened_regression_problem</span><span class="op">$</span><span class="va">formula</span></span></code></pre></div>
<pre><code><span><span class="co">## mpg ~ cyl + disp + hp + drat + wt + vs + am + carb</span></span>
<span><span class="co">## &lt;environment: 0x133eed6d8&gt;</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">screened_regression_problem</span><span class="op">$</span><span class="va">failed_to_correlate_names</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "qsec" "gear"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># step 3: </span></span>
<span><span class="co"># now we can use nadir::super_learner() with the modified problem</span></span>
<span><span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">screened_regression_problem</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">screened_regression_problem</span><span class="op">$</span><span class="va">formula</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_lm</span>, <span class="va">lnr_earth</span>, <span class="va">lnr_rf</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sl_predictor</span></span>
<span><span class="co">## function(newdata) {</span></span>
<span><span class="co">##     # for each model, predict on the newdata and apply the model weights</span></span>
<span><span class="co">##     future_lapply(1:length(fit_learners), function(i) {</span></span>
<span><span class="co">##       fit_learners[[i]](newdata) * learner_weights[[i]]</span></span>
<span><span class="co">##     }, future.seed = TRUE) |&gt;</span></span>
<span><span class="co">##       Reduce(`+`, x = _) # aggregate across the weighted model predictions</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">## &lt;bytecode: 0x1341def28&gt;</span></span>
<span><span class="co">## &lt;environment: 0x1341ef698&gt;</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $y_variable</span></span>
<span><span class="co">## [1] "mpg"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $outcome_type</span></span>
<span><span class="co">## [1] "continuous"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $learner_weights</span></span>
<span><span class="co">##         lm      earth         rf </span></span>
<span><span class="co">## 0.08265103 0.00000000 0.91734897 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $holdout_predictions</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 32 × 5</span></span></span>
<span><span class="co">##    .sl_fold    lm earth    rf   mpg</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        1 22.6   17.0  19.6  21.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        1 18.0   15.0  16.3  18.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        1 21.5   17.6  19.0  18.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        1 12.7   12.9  13.4  10.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        1 17.4   21.6  19.9  19.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        1  9.47  16.2  15.4  15  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        2 21.9   18.6  20.5  21  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        2 21.1   20.4  23.0  24.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        2 12.3   15.1  16.9  16.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>        2 13.8   16.2  17.0  15.2</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 22 more rows</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "list"                    "nadir_sl_verbose_output"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use super_learner() as you would, just with the updated formula and data</span></span></code></pre></div>
<p>It should be noted that this functionality should be used with fairly
extreme discretion. The point of offering it is that there are settings
in which a huge number of variables may be computationally challenging,
but it is likely that screening out variables may induce some issues
around post-selection inference.</p>
</div>
<div class="section level2">
<h2 id="adding-a-screening-layer-into-a-learner">Adding a Screening Layer into a Learner<a class="anchor" aria-label="anchor" href="#adding-a-screening-layer-into-a-learner"></a>
</h2>
<p>In contrast to the above approach, another approach to screening
variables is to screen them out within a given learner. This involves
constructing learners that have screening “baked in” so to speak.</p>
<p>To construct these new learners, one should use the
<code>add_learner(learner, screener, screener_extra_args)</code>
function, which returns a new learner.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct some new learners with varying levels and types of screening</span></span>
<span> </span>
<span><span class="co"># here we just show a small sample of examples manually constructed:</span></span>
<span><span class="va">lnr_glm_screened_pearson_cor_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_screener.html">add_screener</a></span><span class="op">(</span><span class="va">lnr_glm</span>, <span class="va">screener_cor</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lnr_glm_screened_spearman_cor_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_screener.html">add_screener</a></span><span class="op">(</span><span class="va">lnr_glm</span>, <span class="va">screener_cor</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span>, cor... <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'spearman'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lnr_rf_screened_cor_top_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_screener.html">add_screener</a></span><span class="op">(</span><span class="va">lnr_rf</span>, <span class="va">screener_cor_top_n</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keep_n_terms <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lnr_earth_screened_t_test_p_lt_05</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_screener.html">add_screener</a></span><span class="op">(</span><span class="va">lnr_earth</span>, <span class="va">screener_t_test</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p_value_threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use the learners with built-in screeners in a super_learner():</span></span>
<span><span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MASS/man/Boston.html" class="external-link">Boston</a></span>, </span>
<span>  formula <span class="op">=</span> <span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">lnr_glm_screened_pearson_cor_50</span>, <span class="va">lnr_glm_screened_spearman_cor_50</span>,</span>
<span>    <span class="va">lnr_rf_screened_cor_top_5</span>, <span class="va">lnr_earth_screened_t_test_p_lt_05</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sl_predictor</span></span>
<span><span class="co">## function(newdata) {</span></span>
<span><span class="co">##     # for each model, predict on the newdata and apply the model weights</span></span>
<span><span class="co">##     future_lapply(1:length(fit_learners), function(i) {</span></span>
<span><span class="co">##       fit_learners[[i]](newdata) * learner_weights[[i]]</span></span>
<span><span class="co">##     }, future.seed = TRUE) |&gt;</span></span>
<span><span class="co">##       Reduce(`+`, x = _) # aggregate across the weighted model predictions</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">## &lt;bytecode: 0x1341def28&gt;</span></span>
<span><span class="co">## &lt;environment: 0x13573ae48&gt;</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $y_variable</span></span>
<span><span class="co">## [1] "medv"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $outcome_type</span></span>
<span><span class="co">## [1] "continuous"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $learner_weights</span></span>
<span><span class="co">## cor_threshold_screened_glm_1 cor_threshold_screened_glm_2 </span></span>
<span><span class="co">##                    0.0000000                    0.0000000 </span></span>
<span><span class="co">##        cor_top_n_screened_rf        t_test_screened_earth </span></span>
<span><span class="co">##                    0.4219593                    0.5780407 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $holdout_predictions</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 506 × 6</span></span></span>
<span><span class="co">##    .sl_fold cor_threshold_screene…¹ cor_threshold_screen…² cor_top_n_screened_rf</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        1                    31.7                   32.1                  33.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        1                    30.7                   30.4                  34.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        1                    21.8                   23.1                  22.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        1                    24.3                   25.2                  21.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        1                    22.5                   22.0                  20.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        1                    22.0                   20.9                  19.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        1                    18.1                   18.8                  17.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        1                    16.5                   17.5                  16.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        1                    14.5                   15.4                  15.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>        1                    28.7                   28.0                  30.5</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 496 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​cor_threshold_screened_glm_1,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ²​cor_threshold_screened_glm_2</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: t_test_screened_earth &lt;dbl&gt;, medv &lt;dbl&gt;</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "list"                    "nadir_sl_verbose_output"</span></span></code></pre>
<p>While the above approach shows how to construct screeners manually,
there may be settings in which constructing screened learners
programmatically is beneficial. Here we show how to produce an array of
learners with built-in screeners programmatically:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct new learners with builtin screeners</span></span>
<span><span class="co"># =============================================</span></span>
<span></span>
<span><span class="co"># learners</span></span>
<span><span class="va">base_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_glm</span>, <span class="va">lnr_hal</span>, <span class="va">lnr_earth</span>, <span class="va">lnr_rf</span>, <span class="va">lnr_glmnet</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># screeners</span></span>
<span><span class="va">screeners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">screener_cor</span>, <span class="va">screener_cor</span>, <span class="va">screener_cor</span>, <span class="va">screener_cor_top_n</span><span class="op">)</span></span>
<span><span class="va">screener_extra_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keep_n_terms <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># ensure that the screeners and screener_extra_args are the same length</span></span>
<span></span>
<span><span class="co"># set up a grid of combinations of learners and screeners</span></span>
<span><span class="co"># we'll refer to them by indices to avoid duplicating objects unnecessarily </span></span>
<span><span class="va">learner_screener_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>learner <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">base_learners</span><span class="op">)</span>, screener <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">screeners</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">learner_screener_grid</span><span class="op">)</span>, \<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">learner_i</span> <span class="op">&lt;-</span> <span class="va">learner_screener_grid</span><span class="op">[[</span><span class="st">'learner'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">screener_i</span> <span class="op">&lt;-</span> <span class="va">learner_screener_grid</span><span class="op">[[</span><span class="st">'screener'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">new_learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_screener.html">add_screener</a></span><span class="op">(</span>learner <span class="op">=</span> <span class="va">base_learners</span><span class="op">[[</span><span class="va">learner_i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                              screener <span class="op">=</span> <span class="va">screeners</span><span class="op">[[</span><span class="va">screener_i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                              screener_extra_args <span class="op">=</span> <span class="va">screener_extra_args</span><span class="op">[[</span><span class="va">screener_i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">new_learner</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># run super_learner() with the new screeners</span></span>
<span><span class="co"># ==========================================</span></span>
<span></span>
<span><span class="co"># memory expanded to deal with a large number of learners</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>future.globals.maxSize <span class="op">=</span> <span class="fl">8000</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">nadir</span><span class="fu">::</span><span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu">MASS</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MASS/man/Boston.html" class="external-link">Boston</a></span>, </span>
<span>  formula <span class="op">=</span> <span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">new_learners</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $sl_predictor</span></span>
<span><span class="co">## function(newdata) {</span></span>
<span><span class="co">##     # for each model, predict on the newdata and apply the model weights</span></span>
<span><span class="co">##     future_lapply(1:length(fit_learners), function(i) {</span></span>
<span><span class="co">##       fit_learners[[i]](newdata) * learner_weights[[i]]</span></span>
<span><span class="co">##     }, future.seed = TRUE) |&gt;</span></span>
<span><span class="co">##       Reduce(`+`, x = _) # aggregate across the weighted model predictions</span></span>
<span><span class="co">##   }</span></span>
<span><span class="co">## &lt;bytecode: 0x1341def28&gt;</span></span>
<span><span class="co">## &lt;environment: 0x1343950e8&gt;</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $y_variable</span></span>
<span><span class="co">## [1] "medv"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $outcome_type</span></span>
<span><span class="co">## [1] "continuous"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $learner_weights</span></span>
<span><span class="co">##    cor_threshold_screened_glm_1    cor_threshold_screened_hal_1 </span></span>
<span><span class="co">##                      0.00000000                      0.14714937 </span></span>
<span><span class="co">##  cor_threshold_screened_earth_1     cor_threshold_screened_rf_1 </span></span>
<span><span class="co">##                      0.04341371                      0.00000000 </span></span>
<span><span class="co">## cor_threshold_screened_glmnet_1    cor_threshold_screened_glm_2 </span></span>
<span><span class="co">##                      0.00000000                      0.00000000 </span></span>
<span><span class="co">##    cor_threshold_screened_hal_2  cor_threshold_screened_earth_2 </span></span>
<span><span class="co">##                      0.00000000                      0.00000000 </span></span>
<span><span class="co">##     cor_threshold_screened_rf_2 cor_threshold_screened_glmnet_2 </span></span>
<span><span class="co">##                      0.44293555                      0.00000000 </span></span>
<span><span class="co">##    cor_threshold_screened_glm_3    cor_threshold_screened_hal_3 </span></span>
<span><span class="co">##                      0.00000000                      0.02000205 </span></span>
<span><span class="co">##  cor_threshold_screened_earth_3     cor_threshold_screened_rf_3 </span></span>
<span><span class="co">##                      0.00000000                      0.00000000 </span></span>
<span><span class="co">## cor_threshold_screened_glmnet_3          cor_top_n_screened_glm </span></span>
<span><span class="co">##                      0.00000000                      0.00000000 </span></span>
<span><span class="co">##          cor_top_n_screened_hal        cor_top_n_screened_earth </span></span>
<span><span class="co">##                      0.10746165                      0.00000000 </span></span>
<span><span class="co">##           cor_top_n_screened_rf       cor_top_n_screened_glmnet </span></span>
<span><span class="co">##                      0.23903768                      0.00000000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $holdout_predictions</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 506 × 22</span></span></span>
<span><span class="co">##    .sl_fold cor_threshold_screen…¹ cor_threshold_screen…² cor_threshold_screen…³</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>        1                   31.3                   29.1                   36.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>        1                   30.8                   30.2                   32.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>        1                   25.9                   21.6                   22.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>        1                   23.6                   20.4                   20.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>        1                   25.9                   20.5                   21.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>        1                   17.5                   17.4                   17.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>        1                   14.2                   19.5                   19.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>        1                   16.3                   17.3                   15.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>        1                   21.2                   20.2                   19.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>        1                   22.9                   21.2                   20.7</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 496 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated names: ¹​cor_threshold_screened_glm_1,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ²​cor_threshold_screened_hal_1, ³​cor_threshold_screened_earth_1</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 18 more variables: cor_threshold_screened_rf_1 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   cor_threshold_screened_glmnet_1 &lt;dbl&gt;, cor_threshold_screened_glm_2 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   cor_threshold_screened_hal_2 &lt;dbl&gt;, cor_threshold_screened_earth_2 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   cor_threshold_screened_rf_2 &lt;dbl&gt;, cor_threshold_screened_glmnet_2 &lt;dbl&gt;, …</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "list"                    "nadir_sl_verbose_output"</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ctesta.com" class="external-link">Christian Testa</a>, <a href="https://nimahejazi.org/" class="external-link">Nima Hejazi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
