<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Survival Analysis via Pooled Logistic Regression • nadir</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Survival Analysis via Pooled Logistic Regression">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nadir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Basic-Examples.html">Basic Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Benchmarking.html">Benchmarking Against `{SuperLearner}` and `{sl3}`</a></li>
    <li><a class="dropdown-item" href="../articles/Binary-and-Multiclass-Outcomes.html">Binary and Multiclass Outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/Clustered-Data.html">Clustered and Dependent Data</a></li>
    <li><a class="dropdown-item" href="../articles/comparison_to_SuperLearner.html">Comparison to `{SuperLearner}` and `{sl3}`</a></li>
    <li><a class="dropdown-item" href="../articles/Creating-Learners.html">Creating Learners</a></li>
    <li><a class="dropdown-item" href="../articles/currying_closures_and_function_factories.html">Currying, Closures, and Function Factories</a></li>
    <li><a class="dropdown-item" href="../articles/Density-Estimation.html">Density Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Doubly-Robust-Estimation.html">Doubly Robust Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Error-Handling.html">Error Handling</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><a class="dropdown-item" href="../articles/Guidance-for-Developers.html">Guidance for Developers</a></li>
    <li><a class="dropdown-item" href="../articles/Running-super_learner-in-Parallel.html">Running `super_learner()` in Parallel</a></li>
    <li><a class="dropdown-item" href="../articles/Screeners.html">Screeners</a></li>
    <li><a class="dropdown-item" href="../articles/Survival.html">Survival Analysis via Pooled Logistic Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Using-Weights.html">Using Observation Weights</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizing-Performance.html">Visualizing Performance</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ctesta01/nadir/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Survival Analysis via Pooled Logistic Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctesta01/nadir/blob/HEAD/vignettes/articles/Survival.Rmd" class="external-link"><code>vignettes/articles/Survival.Rmd</code></a></small>
      <div class="d-none name"><code>Survival.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="review-of-pooled-logistic-regression">Review of Pooled Logistic Regression<a class="anchor" aria-label="anchor" href="#review-of-pooled-logistic-regression"></a>
</h2>
<p>Pooled logistic regression is a statistical method for performing a
logistic regression that yields parameter estimates that are
asymptotically equivalent to those of Cox proportional hazards
regression. The procedure works by repeating observations from a
conventional survival (or time-to-event) dataset for as many observation
periods that each row is observed until either of its event or censoring
time. By doing so, the logistic regression can treat the rows associated
with a given observation period (e.g., often a day) as the active risk
set of observations, and a logistic regression on the indicator of an
event yields an approximation to the instantaneous hazard.</p>
<p>As an example (from the Introduction section of Craig et al. 2025),
the pooled logistic regression approach works by converting the
following original survival dataset:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">covariate 1</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">covariate 2</mtext></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>12</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>21</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>22</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>31</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>32</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>y</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">survival time</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">event</mtext></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>t</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>t</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>t</mi><mn>3</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
X = 
\begin{pmatrix}
\text{covariate 1} &amp; \text{covariate 2} \\
x_{11} &amp; x_{12} \\
x_{21} &amp; x_{22} \\
x_{31} &amp; x_{32}
\end{pmatrix}, \quad
y = 
\begin{pmatrix}
\text{survival time} &amp; \text{event} \\ 
t_1 &amp; 1 \\
t_2 &amp; 0 \\
t_3 &amp; 1
\end{pmatrix}.
</annotation></semantics></math> into the following:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>X</mi><mo accent="true">̃</mo></mover><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">covariate 1</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">covariate 2</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">risk set 1</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">risk set 2</mtext></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>11</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>12</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>21</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>22</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>31</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>32</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>31</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>x</mi><mn>32</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mover><mi>y</mi><mo accent="true">̃</mo></mover><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">event</mtext></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\tilde{X} = 
\begin{pmatrix}
\text{covariate 1} &amp; \text{covariate 2} &amp; \text{risk set 1} &amp; \text{risk set 2} \\
x_{11} &amp; x_{12} &amp; 1 &amp; 0 \\
x_{21} &amp; x_{22} &amp; 1 &amp; 0 \\
x_{31} &amp; x_{32} &amp; 1 &amp; 0 \\
x_{31} &amp; x_{32} &amp; 0 &amp; 1
\end{pmatrix}, \quad
\tilde{y} = 
\begin{pmatrix}
\text{event} \\
1 \\
0 \\
0 \\
1
\end{pmatrix}.
</annotation></semantics></math></p>
<p>One of the key utilities of the pooled logistic regression approach
is that it allows for straightforward incorporation of
time-varying-covariates and/or interactions with time.</p>
<p>References on the method:</p>
<ul>
<li>
<a href="https://www.degruyterbrill.com/document/doi/10.1515/ijb-2022-0055/html" class="external-link">Craig,
Zhong, and Tibshirani. <em>A review of survival stacking: a method to
cast survival regression analysis as a classification problem</em>. Int.
J. Biostatistics, 2025</a> (<a href="https://arxiv.org/abs/2107.13480" class="external-link">also on arXiv here</a>)</li>
<li><a href="link.springer.com/chapter/10.1007/978-1-4419-9782-1_16">Polley and
van der Laan. <em>Super Learning for Right-Censored Data</em>, Chapter
16 in <em>Targeted Learning: Causal Inference for Observational and
Experimental Data</em>, 2011</a></li>
<li><a href="https://arxiv.org/abs/2504.13291" class="external-link">Zivich, Cole, Shook-Sa,
DeMonte, and Edwards. <em>Estimating equations for survival analysis
with pooled logistic regression</em>. arXiv, 2025</a></li>
<li><a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780091214" class="external-link">D’Agostino,
Lee, Belanger, Cupples, Anderson, Kannel. <em>Relation of pooled
logistic regression to time dependent cox regression analysis: The
framingham heart study</em>. Stat Med 1990</a></li>
<li><a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780070122" class="external-link">Cupples,
D’Agostino, Anderson, Kannel. <em>Comparison of baseline and repeated
measure covariate techniques in the Framingham heart study</em>. Stat
Med 1988</a></li>
</ul>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<div class="section level4">
<h4 id="replicating-the-table-1-from-craig-et-al--2025">Replicating the Table 1 from Craig et al. 2025<a class="anchor" aria-label="anchor" href="#replicating-the-table-1-from-craig-et-al--2025"></a>
</h4>
<p>To begin with a simple example, we illustrate here the (asymptotic)
equivalence of the pooled logistic regression to Cox proportional
hazards regression in a single example. In this example, we use the
observations from the Rotterdam tumor recurrence dataset. The goal of
this example is to be able to compare the Cox proportional hazard model
coefficients with the model coefficients from the pooled logistic
regression to see that they are close to each other.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctesta01.github.io/nadir/">nadir</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/survivalVignettes" class="external-link">survivalVignettes</a></span><span class="op">)</span> <span class="co"># contains the rotterdam data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># extract the original data</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">rotterdam</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nodes</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1546   15</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1546 matches the Craig et al paper population</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">dtime</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">dtime</span> <span class="op">/</span> <span class="fl">365</span> <span class="co"># put time in years for computing convenience</span></span>
<span></span>
<span><span class="va">repeated_measures_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># group by all the “id‐level” fields</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nest_by.html" class="external-link">nest_by</a></span><span class="op">(</span><span class="va">pid</span>, <span class="va">dtime</span>, <span class="va">hormon</span>, <span class="va">age</span>, <span class="va">meno</span>, <span class="va">grade</span>, <span class="va">nodes</span>, <span class="va">pgr</span>, <span class="va">er</span>, <span class="va">death</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># for each subject, make one row per integer t in [start, stop]</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    removal_indicator <span class="op">=</span> <span class="va">death</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">dtime</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span> <span class="op">&lt;</span> <span class="fl">0</span>,</span>
<span>    t   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">death</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">dtime</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">dtime</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">hormon</span>, <span class="co"># hormone treatment</span></span>
<span>    <span class="va">age</span>, <span class="co"># age</span></span>
<span>    <span class="va">meno</span>, <span class="co"># menopause </span></span>
<span>    <span class="va">grade</span>, <span class="co"># grade</span></span>
<span>    <span class="va">nodes</span>, <span class="co"># positive nodes</span></span>
<span>    <span class="va">pgr</span>, <span class="co"># progesterone </span></span>
<span>    <span class="va">er</span>, <span class="co"># estrogen</span></span>
<span>    event <span class="op">=</span> <span class="va">death</span>, <span class="co"># 1 is a true failure </span></span>
<span>    event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">event</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">t</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">dtime</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span> <span class="va">removal_indicator</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">removal_indicator</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pooled_logistic_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">repeated_measures_df</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">hormon</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="va">hormon</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span> <span class="va">grade</span> <span class="op">+</span> <span class="va">nodes</span> <span class="op">+</span> <span class="va">pgr</span> <span class="op">+</span> <span class="va">er</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">'logit'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_coefficients</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">pooled_logistic_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_pooled_logistic_coefs</span> <span class="op">&lt;-</span> <span class="va">tidy_coefficients</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'hormon'</span>, <span class="st">'age'</span>, <span class="st">'meno'</span>, <span class="st">'grade'</span>, <span class="st">'nodes'</span>, <span class="st">'pgr'</span>, <span class="st">'er'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>, <span class="va">p.value</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare to the equivalent Coxph model:</span></span>
<span><span class="va">tidy_coxph_coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">dtime</span>, <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">hormon</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">meno</span> <span class="op">+</span> <span class="va">grade</span> <span class="op">+</span> <span class="va">nodes</span> <span class="op">+</span> <span class="va">pgr</span> <span class="op">+</span> <span class="va">er</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>, <span class="va">p.value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_coefs</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tidy_pooled_logistic_coefs</span>, <span class="va">tidy_coxph_coefs</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'term'</span> <span class="op">=</span> <span class="st">'term'</span><span class="op">)</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'_logistic'</span>, <span class="st">'_coxph'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_coefs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">'estimate'</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">'p.value'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">'Pooled Logistic (log ORs) and Cox Proportional Hazard Coefficient Estimates (log HRs) Side-by-Side'</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Pooled Logistic (log ORs) and Cox Proportional Hazard
Coefficient Estimates (log HRs) Side-by-Side</caption>
<colgroup>
<col width="9%">
<col width="25%">
<col width="21%">
<col width="23%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate_logistic</th>
<th align="right">estimate_coxph</th>
<th align="right">p.value_logistic</th>
<th align="right">p.value_coxph</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">hormon</td>
<td align="right">-0.2824439</td>
<td align="right">-0.2978688</td>
<td align="right">0.0036511</td>
<td align="right">0.0010939</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.0206446</td>
<td align="right">0.0199086</td>
<td align="right">0.0000171</td>
<td align="right">0.0000100</td>
</tr>
<tr class="odd">
<td align="left">meno</td>
<td align="right">0.0409336</td>
<td align="right">0.0398473</td>
<td align="right">0.7494097</td>
<td align="right">0.7403544</td>
</tr>
<tr class="even">
<td align="left">grade</td>
<td align="right">0.3872314</td>
<td align="right">0.3676658</td>
<td align="right">0.0000205</td>
<td align="right">0.0000204</td>
</tr>
<tr class="odd">
<td align="left">nodes</td>
<td align="right">0.0689977</td>
<td align="right">0.0607740</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">pgr</td>
<td align="right">-0.0004300</td>
<td align="right">-0.0004102</td>
<td align="right">0.0066412</td>
<td align="right">0.0069825</td>
</tr>
<tr class="odd">
<td align="left">er</td>
<td align="right">-0.0003105</td>
<td align="right">-0.0002964</td>
<td align="right">0.0417136</td>
<td align="right">0.0399260</td>
</tr>
</tbody>
</table>
<p>The example shown here is just for illustrative purposes. <strong>The
approximation error in this example can be decreased in this example by
coarsening the time-windows less</strong> (e.g., carrying out the pooled
logistic regression with daily risk sets), but it takes more
compute-time to do so.</p>
</div>
<div class="section level4">
<h4 id="comparing-and-contrasting-different-approaches-to-time">Comparing and Contrasting Different Approaches to Time<a class="anchor" aria-label="anchor" href="#comparing-and-contrasting-different-approaches-to-time"></a>
</h4>
<p>There are at least three ways that time can be handled:</p>
<ul>
<li>As the Craig et al. paper describes in the Introduction, as
providing the basis for discrete risk sets.</li>
<li>As another continuous predictor variable with a scalar coefficient
on it.</li>
<li>As another continuous predictor variable with a smoothing spline on
it.</li>
</ul>
<p>See <strong>Section 3.1 Functional Form for Time</strong> from Zivich
et al 2025 for the details.</p>
<p>If time is modeled as a set of distinct indicators for each
time-period, then this imposes no additional constraints on the baseline
hazard and is most similar to the approach of Cox proportional
hazards.</p>
<p>If time is treated as a numeric column with an estimated scalar model
coefficient, then this is akin to the restriction of an exponential
model.</p>
<p>Finally, using a spline is somewhat in-between.</p>
<p>To illustrate this point, we visualize the following three separate
model fits:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct a person-period level dataset from the survival::bladder data</span></span>
<span><span class="va">repeated_measures_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/df_to_survival_stacked.html">df_to_survival_stacked</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/survival/man/bladder.html" class="external-link">bladder</a></span>,</span>
<span>    time_col <span class="op">=</span> <span class="st">'stop'</span>,</span>
<span>    status_col <span class="op">=</span> <span class="st">'event'</span>,</span>
<span>    covariate_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'rx'</span>, <span class="st">'size'</span>, <span class="st">'number'</span>, <span class="st">'size'</span>, <span class="st">'enum'</span><span class="op">)</span>,</span>
<span>    id_col <span class="op">=</span> <span class="st">'id'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_super_learned_pooled_logistic_regression</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">data</span>,</span>
<span>    <span class="va">formulas</span>,</span>
<span>    <span class="va">learners</span>,</span>
<span>    <span class="va">extra_learner_args</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">title</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sl_fit_for_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>    data         <span class="op">=</span> <span class="va">data</span>,</span>
<span>    formulas     <span class="op">=</span> <span class="va">formulas</span>,</span>
<span>    learners     <span class="op">=</span> <span class="va">learners</span>,</span>
<span>    y_variable <span class="op">=</span> <span class="st">'event'</span>, <span class="co"># TODO: FIX this so y_variable doesn't need to be explicitly passed</span></span>
<span>    outcome_type <span class="op">=</span> <span class="st">"binary"</span>,</span>
<span>    extra_learner_args <span class="op">=</span> <span class="va">extra_learner_args</span>,</span>
<span>    n_folds      <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    cv_schema <span class="op">=</span> \<span class="op">(</span><span class="va">data</span>, <span class="va">n_folds</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="../reference/cv_origami_schema.html">cv_origami_schema</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, n_folds <span class="op">=</span> <span class="va">n_folds</span>, cluster_ids <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="op">}</span>,</span>
<span>    verbose_output <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># grid for kaplan meier curves</span></span>
<span>  <span class="va">grid1_for_km</span> <span class="op">&lt;-</span> <span class="va">repeated_measures_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rx <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">grid2_for_km</span> <span class="op">&lt;-</span> <span class="va">grid1_for_km</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rx <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># calculate hazards</span></span>
<span>  <span class="va">h1_for_km</span> <span class="op">&lt;-</span> <span class="fu">sl_fit_for_km</span><span class="op">(</span><span class="va">grid1_for_km</span><span class="op">)</span>   <span class="co"># P(event at t | A=0)</span></span>
<span>  <span class="va">h2_for_km</span> <span class="op">&lt;-</span> <span class="fu">sl_fit_for_km</span><span class="op">(</span><span class="va">grid2_for_km</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># compute survival curves S(t)=Product_{u&lt;=t} [1−h(u)]</span></span>
<span>  <span class="va">surv_df_for_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    t   <span class="op">=</span> <span class="va">grid1_for_km</span><span class="op">$</span><span class="va">t</span>,</span>
<span>    h1  <span class="op">=</span> <span class="va">h1_for_km</span>,</span>
<span>    h2  <span class="op">=</span> <span class="va">h2_for_km</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      S1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">h1</span><span class="op">)</span>,</span>
<span>      S2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">h2</span><span class="op">)</span>,</span>
<span>      HR <span class="op">=</span> <span class="va">h2</span> <span class="op">/</span> <span class="va">h1</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># plot </span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">surv_df_for_km</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">S1</span>, color <span class="op">=</span> <span class="st">"rx=1"</span><span class="op">)</span>, direction <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_step</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">S2</span>, color <span class="op">=</span> <span class="st">"rx=2"</span><span class="op">)</span>, direction <span class="op">=</span> <span class="st">"hv"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="st">"Estimated survival probability"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"Treatment arm"</span>,</span>
<span>      title <span class="op">=</span> <span class="va">title</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bladder</span><span class="op">$</span><span class="va">stop</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># discrete time hazard model: </span></span>
<span><span class="co"># most similar to Cox proportional hazards:</span></span>
<span><span class="fu">plot_super_learned_pooled_logistic_regression</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">repeated_measures_df</span>,</span>
<span>  formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  learners     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_logistic</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Discrete-time survival curves from pooled-logistic SL"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in stats::optim(par = weights_before_softmax, fn = loss_fn, method = "Nelder-Mead"): one-dimensional optimization by Nelder-Mead is unreliable:</span></span>
<span><span class="co">## use "Brent" or optimize() directly</span></span></code></pre>
<p><img src="Survival_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># continuous time hazard with a scalar coefficient: </span></span>
<span><span class="co"># replicates an Exponential continuous-time hazard model:</span></span>
<span><span class="fu">plot_super_learned_pooled_logistic_regression</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">repeated_measures_df</span>,</span>
<span>  formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">t</span><span class="op">)</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_logistic</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Survival curves from pooled-logistic SL using GLM with time as a numeric column and a scalar coefficient"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in stats::optim(par = weights_before_softmax, fn = loss_fn, method = "Nelder-Mead"): one-dimensional optimization by Nelder-Mead is unreliable:</span></span>
<span><span class="co">## use "Brent" or optimize() directly</span></span></code></pre>
<p><img src="Survival_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># continuous time hazard with a smoothing spline: </span></span>
<span><span class="fu">plot_super_learned_pooled_logistic_regression</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">repeated_measures_df</span>,</span>
<span>  formulas     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  learners     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_gam</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Survival curves from pooled-logistic SL using GAM with s(t)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in stats::optim(par = weights_before_softmax, fn = loss_fn, method = "Nelder-Mead"): one-dimensional optimization by Nelder-Mead is unreliable:</span></span>
<span><span class="co">## use "Brent" or optimize() directly</span></span></code></pre>
<p><img src="Survival_files/figure-html/unnamed-chunk-1-3.png" width="700"></p>
<p>Since the highly adaptive lasso (HAL) (see <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5662030/" class="external-link uri">https://pmc.ncbi.nlm.nih.gov/articles/PMC5662030/</a>, <a href="https://github.com/tlverse/hal9001" class="external-link uri">https://github.com/tlverse/hal9001</a>) has been trending
lately, we also show some examples using HAL. Additionally, we finally
show the utility of the <code><a href="../reference/super_learner.html">super_learner()</a></code> to choose/weight
across multiple candidate learners.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">truncate_lnr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lnr</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">truncate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">max</span><span class="op">)</span>, <span class="va">min</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># needs to return a learner, so it returns a function that </span></span>
<span>  <span class="co"># takes in its inputs and returns a prediction function</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">predictor_fn</span> <span class="op">&lt;-</span> <span class="fu">lnr</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> </span>
<span>      <span class="va">truncated_predictor_fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/seek.html" class="external-link">truncate</a></span><span class="op">(</span><span class="fu">predictor_fn</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">truncated_predictor_fn</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># create a truncated version of the HAL learner</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># we this here because HAL with family = 'binomial' runs much, much slower than</span></span>
<span><span class="co"># HAL with a continuous outcome.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># since, in principle, super_learner() will pick/weight the best performing</span></span>
<span><span class="co"># models, agnostic of whether or not their functional form is 'correct', it</span></span>
<span><span class="co"># should be fine to use a truncated continuous-outcome HAL for demonstrative</span></span>
<span><span class="co"># purposes here.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># for a real application, we would recommend using `family = 'binomial'` as an </span></span>
<span><span class="co"># extra learner argument for HAL.</span></span>
<span><span class="va">lnr_truncated_hal</span> <span class="op">&lt;-</span> <span class="fu">truncate_lnr</span><span class="op">(</span><span class="va">lnr_hal</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># pooling across several learners </span></span>
<span><span class="fu">plot_super_learned_pooled_logistic_regression</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">repeated_measures_df</span>,</span>
<span>  formulas     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="va">t</span>,</span>
<span>                      unrestricted_baseline_hazard <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>,</span>
<span>                      gam <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="va">rx</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  learners     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>unrestricted_baseline_hazard <span class="op">=</span> <span class="va">lnr_logistic</span>, </span>
<span>                      <span class="co"># exponential = lnr_logistic,</span></span>
<span>                      gam <span class="op">=</span> <span class="va">lnr_gam</span>,</span>
<span>                      hal1 <span class="op">=</span> <span class="va">lnr_truncated_hal</span>,</span>
<span>                      hal2 <span class="op">=</span> <span class="va">lnr_truncated_hal</span>,</span>
<span>                      hal3 <span class="op">=</span> <span class="va">lnr_truncated_hal</span>,</span>
<span>                      hal4 <span class="op">=</span> <span class="va">lnr_truncated_hal</span>,</span>
<span>                      hal5 <span class="op">=</span> <span class="va">lnr_truncated_hal</span><span class="op">)</span>,</span>
<span>  extra_learner_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    hal1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    hal2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_knots <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    hal3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_knots <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    hal4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_knots <span class="op">=</span> <span class="fl">10</span>, smoothness_order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    hal5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num_knots <span class="op">=</span> <span class="fl">10</span>, smoothness_order <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Survival curves from a super learned model"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in validate_learner_types(learners, outcome_type): Learners 3, 4, 5, 6, 7 with names [hal1, hal2, hal3, hal4, hal5] do not have attr(., 'sl_lnr_type') == 'binary'.</span></span>
<span><span class="co">## See the Creating Learners article on the {nadir} website.</span></span>
<span><span class="co">## </span></span></code></pre>
<p><img src="Survival_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="simulation-example-showing-convergence-to-the-cox-proportional-hazard-coefficients">Simulation example showing convergence to the Cox proportional
hazard coefficients<a class="anchor" aria-label="anchor" href="#simulation-example-showing-convergence-to-the-cox-proportional-hazard-coefficients"></a>
</h4>
<p>This shows we can recover the Cox proportional hazard model
coefficients as the time-windows considered get smaller and smaller.</p>
<p><strong>Caution:</strong> This code takes about 30-40 minutes to
run.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multicore</span><span class="op">)</span> <span class="co"># note that `multicore` requires running this in a terminal (not RStudio) </span></span>
<span><span class="co"># on a Unix/Linux machine (not Windows) -- see the future.apply documentation for reference. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># The advantage of `multicore` is that forking processes is quite fast, though this is </span></span>
<span><span class="co"># not supported in Windows or an RStudio session.</span></span>
<span></span>
<span><span class="va">generate_survival_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">n</span>, <span class="co"># sample size </span></span>
<span>    <span class="va">beta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="co"># true log odds ratio coefficients</span></span>
<span>    <span class="va">baseline_rate</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="va">censor_rate</span>   <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># parameter for the Exponential time-to-censoring distribution</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"`beta` must have length 5."</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># simulate covariates</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># linear predictor and event times under Exp(baseline_hazard * exp(eta))</span></span>
<span>  <span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span></span>
<span>  <span class="va">U</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">T_true</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">U</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">baseline_rate</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># independent censoring times ~ Exp(censor_rate)</span></span>
<span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="va">censor_rate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># observed times &amp; event indicator</span></span>
<span>  <span class="va">time</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">T_true</span>, <span class="va">C</span><span class="op">)</span></span>
<span>  <span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">T_true</span> <span class="op">&lt;=</span> <span class="va">C</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return data.frame</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span>, <span class="va">X</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">run_coxph_vs_survstack</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">700</span>, <span class="va">period_duration</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">generate_survival_data</span><span class="op">(</span></span>
<span>    n             <span class="op">=</span> <span class="va">n</span>,</span>
<span>    beta          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0</span>, <span class="fl">1.2</span><span class="op">)</span>,</span>
<span>    baseline_rate <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    censor_rate   <span class="op">=</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># fit a cox proportional hazards model</span></span>
<span>  <span class="va">coxph_model</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">X4</span> <span class="op">+</span> <span class="va">X5</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># extract the log odds ratios</span></span>
<span>  <span class="va">coxph_model_coefs</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">coxph_model</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># convert the original data into a repeated measures data structure</span></span>
<span>  <span class="va">repeated_measures_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">nadir</span><span class="fu">::</span><span class="fu"><a href="../reference/df_to_survival_stacked.html">df_to_survival_stacked</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>      time_col <span class="op">=</span> <span class="st">'time'</span>,</span>
<span>      status_col <span class="op">=</span> <span class="st">'status'</span>,</span>
<span>      covariate_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>      period_duration <span class="op">=</span> <span class="va">period_duration</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># perform the pooled logistic regression</span></span>
<span>  <span class="va">pooled_logistic_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">repeated_measures_df</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">event</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">+</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span> <span class="op">+</span> <span class="va">X4</span> <span class="op">+</span> <span class="va">X5</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">'logit'</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># extract the coefficients</span></span>
<span>  <span class="va">tidy_coefficients</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">pooled_logistic_model</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tidy_coefs_on_tidy_coefficients</span> <span class="op">&lt;-</span> <span class="va">tidy_coefficients</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tidy_coefs_on_tidy_coefficients</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    coxph <span class="op">=</span> <span class="va">coxph_model_coefs</span>,</span>
<span>    survstack <span class="op">=</span> <span class="va">tidy_coefs_on_tidy_coefficients</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n_sims</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">period_duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">.25</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">sim_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="va">sample_size</span>, period_duration <span class="op">=</span> <span class="va">period_duration</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_grid</span><span class="op">$</span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim_grid</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_grid</span><span class="op">$</span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">future.apply</span><span class="fu">::</span><span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim_grid</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span>,</span>
<span>           \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>             <span class="fu">run_coxph_vs_survstack</span><span class="op">(</span>n <span class="op">=</span> <span class="va">sim_grid</span><span class="op">[[</span><span class="va">i</span>, <span class="st">'sample_size'</span><span class="op">]</span><span class="op">]</span>, period_duration <span class="op">=</span> <span class="va">sim_grid</span><span class="op">[[</span><span class="va">i</span>, <span class="st">'period_duration'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>           <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">results_coxph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span>, \<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span> <span class="va">results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'coxph'</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="va">i</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">results_survstack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_sims</span>, \<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span> <span class="va">results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'survstack'</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="va">i</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">results_coxph</span> <span class="op">&lt;-</span> <span class="va">results_coxph</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'coxph'</span><span class="op">)</span></span>
<span>  <span class="va">results_survstack</span> <span class="op">&lt;-</span> <span class="va">results_survstack</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'survstack'</span><span class="op">)</span></span>
<span>  <span class="va">results_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">results_coxph</span>, <span class="va">results_survstack</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">results_df</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0</span>, <span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="va">betas_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  true_coef <span class="op">=</span> <span class="va">betas</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sim_grid</span>, cols <span class="op">=</span> <span class="st">'results'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sim_results</span>, <span class="va">betas_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'term'</span> <span class="op">=</span> <span class="st">'term'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sim_results</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>         y <span class="op">=</span> <span class="va">term</span>,</span>
<span>         x <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>         color <span class="op">=</span> <span class="va">type</span>,</span>
<span>         fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggridges</span><span class="fu">::</span><span class="fu">geom_density_ridges</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">true_coef</span>, xend <span class="op">=</span> <span class="va">true_coef</span>, </span>
<span>                   yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">term</span>, <span class="st">"[0-9]"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">period_duration</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sim_results</span><span class="op">$</span><span class="va">period_duration</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="va">sample_size</span>, scales <span class="op">=</span> <span class="st">'free'</span>,</span>
<span>            labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span></span>
<span>              .cols <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'sample size: '</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>              .rows <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'time window duration: '</span>, <span class="va">x</span><span class="op">)</span></span>
<span>              <span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'X'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#5dc6cc'</span>, <span class="st">'#FFC377'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#3d9595'</span>, <span class="st">'#f1b35c'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Simulation results of Cox Proportional Hazard vs. Pooled Logistic Regression"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"A variety of sample sizes and time-coarsening window durations are shown; true coefficients in black"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="https://github.com/ctesta01/nadir/blob/main/man/figures/articles_and_vignettes/survival_stacking_simulation_results.png?raw=true" alt="Survival stacking simulation results"><div class="figcaption">Survival stacking simulation results</div>
</div>
<p>Each scenario is run for 30 iterations. Across the columns the sample
size is varied, and across the rows (descending) the time-windows used
for constructing the survival stacked data structure is made finer.</p>
<p><em>Interpretation:</em></p>
<ul>
<li>In the lowest sample size, coarsest time-window simulations (upper
left-hand panel), we can see that both the Cox proportional hazards
model and the pooled logistic regression on survival stacked data have
wide variance.<br>
</li>
<li>Scanning across all sample sizes in the simulations with the
coarsest time-window used (top row), we can see that with time-windows
that are too coarse, the survival stacking approach may be consistently
biased compared to the Cox proportional hazards model.</li>
<li>If we look at the first column, the simulations where the sample
size was low (50) but the time-windows used are increasingly
fine-grained, we can see that while increasing the the fineness of the
time-windows does not remove all of the uncertainty in estimation, as
the time-windows used decrease, the pooled logistic regression approach
and the Cox proportional hazards model begin to produce nearly exactly
the same estimates.</li>
<li>Finally, in the higher sample size, fine time-window regime (bottom
right), we can see that both the Cox proportional hazards model and the
pooled logistic approach with survival stacked data estimate the true
parameters with relatively little uncertainty.</li>
</ul>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ctesta.com" class="external-link">Christian Testa</a>, <a href="https://nimahejazi.org/" class="external-link">Nima Hejazi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
