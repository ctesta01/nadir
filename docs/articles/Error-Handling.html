<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Error Handling • nadir</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Error Handling">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nadir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Basic-Examples.html">Basic Examples</a></li>
    <li><a class="dropdown-item" href="../articles/Benchmarking.html">Benchmarking Against `{SuperLearner}` and `{sl3}`</a></li>
    <li><a class="dropdown-item" href="../articles/Binary-and-Multiclass-Outcomes.html">Binary and Multiclass Outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/Clustered-Data.html">Clustered and Dependent Data</a></li>
    <li><a class="dropdown-item" href="../articles/comparison_to_SuperLearner.html">Comparison to `{SuperLearner}` and `{sl3}`</a></li>
    <li><a class="dropdown-item" href="../articles/Creating-Learners.html">Creating Learners</a></li>
    <li><a class="dropdown-item" href="../articles/currying_closures_and_function_factories.html">Currying, Closures, and Function Factories</a></li>
    <li><a class="dropdown-item" href="../articles/Density-Estimation.html">Density Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Doubly-Robust-Estimation.html">Doubly Robust Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Error-Handling.html">Error Handling</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><a class="dropdown-item" href="../articles/Guidance-for-Developers.html">Guidance for Developers</a></li>
    <li><a class="dropdown-item" href="../articles/Running-super_learner-in-Parallel.html">Running `super_learner()` in Parallel</a></li>
    <li><a class="dropdown-item" href="../articles/Survival.html">Survival Analysis via Pooled Logistic Regression</a></li>
    <li><a class="dropdown-item" href="../articles/Using-Weights.html">Using Observation Weights</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizing-Performance.html">Visualizing Performance</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ctesta01/nadir/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Error Handling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctesta01/nadir/blob/HEAD/vignettes/articles/Error-Handling.Rmd" class="external-link"><code>vignettes/articles/Error-Handling.Rmd</code></a></small>
      <div class="d-none name"><code>Error-Handling.Rmd</code></div>
    </div>

    
    
<p>How are errors handled in <a href="https://ctesta01.github.io/nadir/">nadir</a>?</p>
<p>We try to handle errors gracefully. We understand that specifying
complicated models may not always go smoothly, and models can be
finnicky.</p>
<p>When a candidate learner throws an error during the
<code><a href="../reference/super_learner.html">super_learner()</a></code> training process, we set its weight to 0
and collect the thrown errors for the user in the verbose output.</p>
<p>For example, <code>lnr_lmer</code> will throw an error if the formula
does not use random effects. The below code snippet shows how we collect
the errors and ensure that super learning can continue even if one or
more learners fail.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctesta01.github.io/nadir/">nadir</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'future':</span></span>
<span><span class="co">#&gt;   method               from      </span></span>
<span><span class="co">#&gt;   all.equal.connection parallelly</span></span>
<span></span>
<span><span class="co"># train a super_learner() model</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># lnr_lmer will error because we didn't use random effects</span></span>
<span><span class="va">sl_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  <span class="va">mtcars</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_mean</span>, <span class="va">lnr_lmer</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># observe, prediction falls back to relying on the other learners we specified:</span></span>
<span><span class="co"># in this case, just lnr_mean</span></span>
<span><span class="fu">sl_model</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062</span></span>
<span><span class="co">#&gt;  [9] 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062</span></span>
<span><span class="co">#&gt; [17] 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062</span></span>
<span><span class="co">#&gt; [25] 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062 20.09062</span></span>
<span></span>
<span><span class="co"># if we specify a more complicated super learner, we can see that as long as we</span></span>
<span><span class="co"># specify random effects, lnr_lmer doesn't fail. </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># also, now you can see how {nadir} collects errors in its verbose output.</span></span>
<span><span class="va">sl_verbose_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  <span class="va">mtcars</span>,</span>
<span>  formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    .default <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span>,</span>
<span>    lmer_2 <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">cyl</span><span class="op">)</span> <span class="op">+</span> <span class="va">hp</span><span class="op">)</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">lnr_mean</span>, <span class="va">lnr_lmer</span>, <span class="va">lnr_lmer</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sl_verbose_output</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 8</span></span>
<span><span class="co">#&gt;  $ sl_predictor                    :function (newdata)  </span></span>
<span><span class="co">#&gt;   ..- attr(*, "srcref")= 'srcref' int [1:8] 476 39 482 3 39 3 2670 2676</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "srcfile")=Classes 'srcfilealias', 'srcfile' &lt;environment: 0x10f00e3c8&gt; </span></span>
<span><span class="co">#&gt;  $ y_variable                      : chr "mpg"</span></span>
<span><span class="co">#&gt;  $ outcome_type                    : chr "continuous"</span></span>
<span><span class="co">#&gt;  $ learner_weights                 : Named num [1:2] 0.0539 0.9461</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:2] "mean" "lmer_2"</span></span>
<span><span class="co">#&gt;  $ holdout_predictions             : tibble [32 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ .sl_fold: int [1:32] 1 1 1 1 1 1 1 2 2 2 ...</span></span>
<span><span class="co">#&gt;   ..$ mean    : num [1:32] 20.1 20.1 20.1 20.1 20.1 ...</span></span>
<span><span class="co">#&gt;   ..$ lmer_2  : Named num [1:32] 20.5 19.9 13.9 27 25.4 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:32] "Mazda RX4 Wag" "Merc 280" "Chrysler Imperial" "Toyota Corolla" ...</span></span>
<span><span class="co">#&gt;   ..$ mpg     : num [1:32] 21 19.2 14.7 33.9 21.5 15.5 15 21 22.8 14.3 ...</span></span>
<span><span class="co">#&gt;  $ errors_from_training_cv_stage1  :List of 10</span></span>
<span><span class="co">#&gt;   ..$ message: chr "No random effects terms specified in formula"</span></span>
<span><span class="co">#&gt;   ..$ call   : language lnr_lmer_1(training_data[[1L]], formula = mpg ~ cyl, NULL)</span></span>
<span><span class="co">#&gt;   ..$ message: chr "No random effects terms specified in formula"</span></span>
<span><span class="co">#&gt;   ..$ call   : language lnr_lmer_1(training_data[[2L]], formula = mpg ~ cyl, NULL)</span></span>
<span><span class="co">#&gt;   ..$ message: chr "No random effects terms specified in formula"</span></span>
<span><span class="co">#&gt;   ..$ call   : language lnr_lmer_1(training_data[[3L]], formula = mpg ~ cyl, NULL)</span></span>
<span><span class="co">#&gt;   ..$ message: chr "No random effects terms specified in formula"</span></span>
<span><span class="co">#&gt;   ..$ call   : language lnr_lmer_1(training_data[[4L]], formula = mpg ~ cyl, NULL)</span></span>
<span><span class="co">#&gt;   ..$ message: chr "No random effects terms specified in formula"</span></span>
<span><span class="co">#&gt;   ..$ call   : language lnr_lmer_1(training_data[[5L]], formula = mpg ~ cyl, NULL)</span></span>
<span><span class="co">#&gt;  $ errors_from_predicting_cv_stage2:List of 10</span></span>
<span><span class="co">#&gt;   ..$ message: chr "attempt to apply non-function"</span></span>
<span><span class="co">#&gt;   ..$ call   : language trained_learners[["lmer_1"]][[1L]](validation_data[[1L]])</span></span>
<span><span class="co">#&gt;   ..$ message: chr "attempt to apply non-function"</span></span>
<span><span class="co">#&gt;   ..$ call   : language trained_learners[["lmer_1"]][[2L]](validation_data[[2L]])</span></span>
<span><span class="co">#&gt;   ..$ message: chr "attempt to apply non-function"</span></span>
<span><span class="co">#&gt;   ..$ call   : language trained_learners[["lmer_1"]][[3L]](validation_data[[3L]])</span></span>
<span><span class="co">#&gt;   ..$ message: chr "attempt to apply non-function"</span></span>
<span><span class="co">#&gt;   ..$ call   : language trained_learners[["lmer_1"]][[4L]](validation_data[[4L]])</span></span>
<span><span class="co">#&gt;   ..$ message: chr "attempt to apply non-function"</span></span>
<span><span class="co">#&gt;   ..$ call   : language trained_learners[["lmer_1"]][[5L]](validation_data[[5L]])</span></span>
<span><span class="co">#&gt;  $ erring_learners                 : chr "lmer_1"</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "list" "nadir_sl_verbose_output"</span></span></code></pre></div>
<p>Note that the language objects in the error calls are modified
slightly inside <code><a href="../reference/super_learner.html">super_learner()</a></code> to make them more
user-friendly so that they contain the names of the learners, and
information about what formula, fold, and extra learner arguments they
were called with rather than obscure errors that refer to things like
<code>learners[[i]]</code> and use <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> to
programmatically pass the extra arguments.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ctesta.com" class="external-link">Christian Testa</a>, <a href="https://nimahejazi.org/" class="external-link">Nima Hejazi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
