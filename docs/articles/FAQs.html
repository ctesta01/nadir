<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>FAQs • nadir</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="FAQs">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nadir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/comparison_to_SuperLearner.html">Comparison to `{SuperLearner}`</a></li>
    <li><a class="dropdown-item" href="../articles/currying_closures_and_function_factories.html">Currying, Closures, and Function Factories</a></li>
    <li><a class="dropdown-item" href="../articles/Density-Estimation.html">Density Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Doubly-Robust-Estimation.html">Doubly Robust Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/FAQs.html">FAQs</a></li>
    <li><a class="dropdown-item" href="../articles/Guidance-for-Developers.html">Guidance for Developers</a></li>
    <li><a class="dropdown-item" href="../articles/Visualizing-Performance.html">Visualizing Performance</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ctesta01/nadir/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>FAQs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ctesta01/nadir/blob/HEAD/vignettes/articles/FAQs.Rmd" class="external-link"><code>vignettes/articles/FAQs.Rmd</code></a></small>
      <div class="d-none name"><code>FAQs.Rmd</code></div>
    </div>

    
    
<p>We try to cover some anticipated frequently asked questions here.</p>
<div class="section level4">
<h4 id="i-want-to-use-super_learner-for-binary-outcomes-">I want to use <code>super_learner()</code> for binary outcomes.<a class="anchor" aria-label="anchor" href="#i-want-to-use-super_learner-for-binary-outcomes-"></a>
</h4>
<p>We’ll use the Boston dataset and create a binary outcome for our
regression problem.</p>
<p>And of course, we’ll train a <code><a href="../reference/super_learner.html">super_learner()</a></code> to these
binary outcomes.<br>
To handle binary outcomes, we need to adjust the method for determining
weights. This is because we don’t want to use the default
<code>mse()</code> loss function, but instead we should to rely on using
the negative log likelihood loss on the held-out data. To do this
appropriately in the context of binary data, we use the
<code><a href="../reference/determine_weights_for_binary_outcomes.html">determine_weights_for_binary_outcomes()</a></code> function provided
by <a href="https://ctesta01.github.io/nadir/">nadir</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'Boston'</span>, package <span class="op">=</span> <span class="st">'MASS'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a binary outcome to predict</span></span>
<span><span class="va">Boston</span><span class="op">$</span><span class="va">high_crime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">crim</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">$</span><span class="va">crim</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">Boston</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">crim</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># we need a bit more precision in how we call randomForest for binary outcomes</span></span>
<span><span class="va">lnr_rf_binary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">formula</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="va">newdata</span>, type <span class="op">=</span> <span class="st">'prob'</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># train a super learner on a binary outcome</span></span>
<span><span class="va">trained_binary_super_learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    .default <span class="op">=</span> <span class="va">high_crime</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>    rf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">high_crime</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    logistic <span class="op">=</span> <span class="va">lnr_glm</span>, <span class="co"># for a logistic model, use glm + extra family arguments below</span></span>
<span>    rf <span class="op">=</span> <span class="va">lnr_rf_binary</span>,  <span class="co"># random forest</span></span>
<span>    lm <span class="op">=</span> <span class="va">lnr_lm</span><span class="op">)</span>, <span class="co"># linear probability model</span></span>
<span>  extra_learner_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    logistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">'binomial'</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  determine_super_learner_weights <span class="op">=</span> <span class="fu">nadir</span><span class="fu">::</span><span class="va"><a href="../reference/determine_weights_for_binary_outcomes.html">determine_weights_for_binary_outcomes</a></span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let's take a look at the learned weights</span></span>
<span><span class="va">trained_binary_super_learner</span><span class="op">$</span><span class="va">learner_weights</span></span>
<span><span class="co">#&gt;     logistic           rf           lm </span></span>
<span><span class="co">#&gt; 1.000000e+00 2.691182e-16 4.748858e-20</span></span>
<span></span>
<span><span class="co"># what are the predictions? you can think of them as \hat{P}(Y = 1 | X).</span></span>
<span><span class="co"># i.e., predictions of P(Y = 1) given X where Y and X are the left &amp; right hand</span></span>
<span><span class="co"># side of your regression formula(s)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">trained_binary_super_learner</span><span class="op">$</span><span class="fu">sl_predict</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            1            2            3            4            5            6 </span></span>
<span><span class="co">#&gt; 2.220369e-16 2.220386e-16 2.220375e-16 2.220392e-16 2.220395e-16 2.220400e-16</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># cleanup</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="i-want-to-use-super_learner-for-count-or-nonnegative-outcomes-">I want to use <code>super_learner()</code> for count or nonnegative
outcomes.<a class="anchor" aria-label="anchor" href="#i-want-to-use-super_learner-for-count-or-nonnegative-outcomes-"></a>
</h4>
<p>In principle, you can use <code><a href="../reference/super_learner.html">super_learner()</a></code> for whatever
type of outcomes you want as long as a few things hold:</p>
<ul>
<li>The learners that you pass to <code><a href="../reference/super_learner.html">super_learner()</a></code> predict
that type of outcome.</li>
<li>The loss function used inside the
<code>determine_super_learner_weights()</code> function argument is
consistent with the loss function that should be used with your type of
data. What loss function “should” be used depends on the context, but
using the mean-squared-error loss for continuous outcomes and negative
log likelihood loss for binary outcomes and conditional density models
is what has been written so far. Refer to the source
<code>R/determine_weights.R</code>.</li>
<li>If using <code><a href="../reference/super_learner.html">nadir::super_learner()</a></code> for applications in the
context of Targeted Learning, it may be useful to understand better the
arguments of<br><a href="https://biostats.bepress.com/ucbbiostat/paper130/" class="external-link"><em>Unified
Cross-Validation Methodology For Selection Among Estimators and a
General Cross-Validated Adaptive Epsilon-Net Estimator: Finite Sample
Oracle Inequalities and Examples</em> by Mark van der Laan and Sandrine
Dudoit, 2003</a> first to understand how an appropriate loss function
should be chosen depending on the outcome type. My understanding is that
some people have used Poisson distribution motivated loss functions (<a href="https://discuss.pytorch.org/t/poisson-loss-function/44301/6" class="external-link uri">https://discuss.pytorch.org/t/poisson-loss-function/44301/6</a>,
<a href="https://pytorch.org/docs/stable/generated/torch.nn.PoissonNLLLoss.html" class="external-link uri">https://pytorch.org/docs/stable/generated/torch.nn.PoissonNLLLoss.html</a>)
but I would need to think more about if this is the right thing to do in
general for count outcome data.</li>
</ul>
</div>
<div class="section level4">
<h4 id="what-are-the-limitations-of-nadirsuper_learner">What are the limitations of
<code>nadir::super_learner()</code>?<a class="anchor" aria-label="anchor" href="#what-are-the-limitations-of-nadirsuper_learner"></a>
</h4>
<p>There are a few key limitations of the design.</p>
<ul>
<li>Because <code>learners</code> (see <code><a href="../reference/learners.html">?learners</a></code>) are
understood to be functions that take <code>data</code>, a
<code>formula</code> and return a prediction function, there is little
to no ability (outside of manually following along with the internals of
a learner) to check on the internals of learner fits.
<ul>
<li>That is to say, if you want to peek into the beta coefficients or
other fit statistics of a learner, this is not supported in
<code><a href="../reference/super_learner.html">nadir::super_learner()</a></code> by design. The reasoning is that an
explicit goal of <a href="https://ctesta01.github.io/nadir/">nadir</a> is to keep learner objects
lightweight so that building a <code><a href="../reference/super_learner.html">super_learner()</a></code> can be
fast.</li>
</ul>
</li>
<li>So far, no thought has been put into complex left-hand-sides of
regression equations. There is no support for left-hand-sides that are
not just the name of a column in the <code>data</code> passed. The
advice for now if you want to model some transformation of the
<code>Y</code> variable is to apply the transformation and store that in
the <code>data</code> with a column name and to use that new column name
in your regression formula(s).
<ul>
<li>As an explicit subpoint to call attention to, this means so far, no
work has been put into supporting survival type outcomes.</li>
</ul>
</li>
<li>So far, everything in <a href="https://ctesta01.github.io/nadir/">nadir</a> assumes completeness (no
missingness) of the data.</li>
</ul>
</div>
<div class="section level4">
<h4 id="what-if-the-learner-that-i-want-to-write-really-isnt-formula-based">What if the learner that I want to write really isn’t formula
based?<a class="anchor" aria-label="anchor" href="#what-if-the-learner-that-i-want-to-write-really-isnt-formula-based"></a>
</h4>
<p>A solution for such a case is to more-or-less ditch the formula piece
of a learner entirely, just treating it as an unused argument, and for
your custom needs you can always build learners that encode details of
the structure of your data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">data</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Y'</span></span>
<span></span>
<span><span class="va">lnr_nonformula1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">formula</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># notice by way of knowing things about our data structure, we never reference</span></span>
<span>  <span class="co"># the formula;  so if you truly don't want to use it, you don't have to.</span></span>
<span>  </span>
<span>  <span class="co"># as an example, here we do OLS assuming inputs are numeric matrices — </span></span>
<span>  <span class="co"># this might even be computationally more performant given how much extra</span></span>
<span>  <span class="co"># stuff is inside an lm or glm fit.</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^X"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="st">'Y'</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">model_betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span></span>
<span>  </span>
<span>  <span class="va">learned_predictor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="st">'Y'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">index_of_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span> <span class="op">==</span> <span class="st">'Y'</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">index_of_y</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model_betas</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">[</span>,<span class="op">-</span><span class="va">index_of_y</span>, drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">learned_predictor</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># this is essentially a re-implementation of lnr_mean with no reference to the formula </span></span>
<span><span class="va">lnr_nonformula2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">formula</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>,<span class="st">'Y'</span><span class="op">]</span></span>
<span>  <span class="va">Y_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">learned_predictor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">Y_mean</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">learned_predictor</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">learned_super_learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    nonformula1 <span class="op">=</span> <span class="va">lnr_nonformula1</span>,</span>
<span>    nonformula2 <span class="op">=</span> <span class="va">lnr_nonformula2</span><span class="op">)</span>,</span>
<span>  formulas <span class="op">=</span> <span class="va">.</span> <span class="op">~</span> <span class="va">.</span>, <span class="co"># it doesn't matter what we put here, because neither </span></span>
<span>  <span class="co"># learner uses their formula inputs. </span></span>
<span>  y_variable <span class="op">=</span> <span class="st">'Y'</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># observe that the OLS model gets all the weight because it's the correct model:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">learned_super_learner</span><span class="op">$</span><span class="va">learner_weights</span>, <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="co">#&gt; nonformula1 nonformula2 </span></span>
<span><span class="co">#&gt;           1           0</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># cleanup</span></span></code></pre></div>
<p>So you can see from the immediately prior code snippet, if you have
some niche application where you would like to avoid using the
<code>formulas</code> argument to <code><a href="../reference/super_learner.html">nadir::super_learner()</a></code> at
all, you can do this by taking advantage of what you know about how
you’re going to structure the <code>data</code> argument.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://ctesta.com" class="external-link">Christian Testa</a>, <a href="https://nimahejazi.org/" class="external-link">Nima Hejazi</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
