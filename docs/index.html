<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An implementation of the Super Learner algorithm fond of closures and flexible syntax • nadir</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An implementation of the Super Learner algorithm fond of closures and flexible syntax">
<meta name="description" content="`nadir::super_learner()` offers improvements compared to past implementations of the SuperLearner algorithm including the ability to easily use random-effects specified in formulas (like `y ~ (age | strata) + ...`) and construction of new learners is as simple as writing and passing a new function.">
<meta property="og:description" content="`nadir::super_learner()` offers improvements compared to past implementations of the SuperLearner algorithm including the ability to easily use random-effects specified in formulas (like `y ~ (age | strata) + ...`) and construction of new learners is as simple as writing and passing a new function.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">nadir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/comparison_to_SuperLearner.html">comparison_to_SuperLearner</a></li>
    <li><a class="dropdown-item" href="articles/guidance_for_developers.html">guidance_for_developers</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><a href="https://ctesta01.github.io/nadir/">nadir</a> <a href="https://github.com/ctesta01/nadir/" class="external-link"><img src="logo/nadir_logo.png" align="right" height="138"></a> ================</p>
<p><em>nadir</em> (noun): nā-dir</p>
<blockquote>
<p>the lowest point.</p>
</blockquote>
<p>Fitting with the <em>minimum loss based estimation</em><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;van der Laan, Mark J. and Dudoit, Sandrine, “Unified Cross-Validation Methodology For Selection Among Estimators and a General Cross-Validated Adaptive Epsilon-Net Estimator: Finite Sample Oracle Inequalities and Examples” (November 2003). U.C. Berkeley Division of Biostatistics Working Paper Series. Working Paper 130. &lt;a href="https://biostats.bepress.com/ucbbiostat/paper130" class="external-link uri"&gt;https://biostats.bepress.com/ucbbiostat/paper130&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Zheng, W., &amp;amp; van der Laan, M. J. (2011). Cross-Validated Targeted Minimum-Loss-Based Estimation. In Springer Series in Statistics (pp. 459–474). Springer New York. &lt;a href="https://doi.org/10.1007/978-1-4419-9782-1_27" class="external-link uri"&gt;https://doi.org/10.1007/978-1-4419-9782-1_27&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a> literature, <a href="https://ctesta01.github.io/nadir/">nadir</a> is an implementation of the Super Learner algorithm with improved support for flexible formula based syntax and which is fond of functional programming techniques such as closures and currying.</p>
<hr>
<p><a href="https://ctesta01.github.io/nadir/">nadir</a> implements the Super Learner<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;van der Laan, M. J., Polley, E. C., &amp;amp; Hubbard, A. E. (2007). Super Learner. In Statistical Applications in Genetics and Molecular Biology (Vol. 6, Issue 1). Walter de Gruyter GmbH. &lt;a href="https://doi.org/10.2202/1544-6115.1309" class="external-link uri"&gt;https://doi.org/10.2202/1544-6115.1309&lt;/a&gt; &lt;a href="https://pubmed.ncbi.nlm.nih.gov/17910531/" class="external-link uri"&gt;https://pubmed.ncbi.nlm.nih.gov/17910531/&lt;/a&gt;&lt;/p&gt;'><sup>3</sup></a> algorithm. To quote <em>the Guide to SuperLearner</em><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Guide to &lt;a href="https://github.com/ecpolley/SuperLearner" class="external-link"&gt;SuperLearner&lt;/a&gt;: &lt;a href="https://cran.r-project.org/web/packages/SuperLearner/vignettes/Guide-to-SuperLearner.html" class="external-link uri"&gt;https://cran.r-project.org/web/packages/SuperLearner/vignettes/Guide-to-SuperLearner.html&lt;/a&gt;&lt;/p&gt;'><sup>4</sup></a>:</p>
<blockquote>
<p>SuperLearner is an algorithm that uses cross-validation to estimate the performance of multiple machine learning models, or the same model with different settings. It then creates an optimal weighted average of those models, aka an “ensemble”, using the test data performance. This approach has been proven to be asymptotically as accurate as the best possible prediction algorithm that is tested.</p>
</blockquote>
<div class="section level2">
<h2 id="why-nadir-and-why-reimplement-super-learner-again">Why <code>{nadir}</code> and why reimplement Super Learner again?<a class="anchor" aria-label="anchor" href="#why-nadir-and-why-reimplement-super-learner-again"></a>
</h2>
<p>In previous implementations (<a href="https://github.com/ecpolley/SuperLearner" class="external-link"><code>{SuperLearner}</code></a>, <a href="https://github.com/tlverse/sl3/" class="external-link"><code>{sl3}</code></a>, <a href="https://cran.r-project.org/web/packages/mlr3superlearner/mlr3superlearner.pdf" class="external-link"><code>{mlr3superlearner}</code></a>), support for <em>flexible formula-based syntax</em> has been limited, instead opting for specifying learners as models on an <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math> matrix and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math> outcome vector. Many popular R packages such as <code>lme4</code> and <code>mgcv</code> (for random effects and generalized additive models) use formulas extensively to specify models using syntax like <code>(age | strata)</code> to specify random effects on age by strata, or <code>s(age, income)</code> to specify a smoothing term on <code>age</code> and <code>income</code> simultaneously.</p>
<p>At present, it is difficult to use these kinds of features in <a href="https://github.com/ecpolley/SuperLearner" class="external-link">SuperLearner</a>, <a href="https://tlverse.org/sl3" class="external-link">sl3</a> and <code>{ml3superlearner}</code>.</p>
<p>For example, it is easy to imagine the Super Learner algorithm being appealing to modelers fond of random effects based models because they may want to hedge on the exact nature of the random effects models, not sure if random intercepts are enough or if random slopes should be included, etc., and similar other modeling decisions in other frameworks.</p>
<p>Therefore, the <a href="https://ctesta01.github.io/nadir/">nadir</a> package takes as its charges to:</p>
<ul>
<li>Implement a syntax in which it is easy to specify <em>different formulas</em> for each of many candidate learners.</li>
<li>To make it easy to pass new learners to the Super Learner algorithm.</li>
</ul>
</div>
<div class="section level1">
<div class="page-header"><h1 id="installation-instructions">Installation Instructions<a class="anchor" aria-label="anchor" href="#installation-instructions"></a>
</h1></div>
<p>At present, <a href="https://ctesta01.github.io/nadir/">nadir</a> is only available on GitHub.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ctesta01/nadir"</span><span class="op">)</span></span></code></pre></div>
<p><b><i>Warning: this package is currently under active development and may be wrong!</i> Do not use this for serious applications until this message has been removed, likely at the time of a future release.</b></p>
</div>
<div class="section level1">
<h1 id="demonstration">Demonstration<a class="anchor" aria-label="anchor" href="#demonstration"></a>
</h1>
<p>First, let’s start with the simplest possible use case of <code><a href="reference/super_learner.html">nadir::super_learner()</a></code>, which is where the user would like to feed in data, a specification for some regression formula(s), specify a library of learners, and get back a prediction function that is suitable for plugging into downstream analyses, like in Targeted Learning or for pure-prediction applications.</p>
<p>Here is a demo of an extremely simple application of using <code><a href="reference/super_learner.html">nadir::super_learner</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctesta01.github.io/nadir/">nadir</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we'll use a few basic learners</span></span>
<span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     glm <span class="op">=</span> <span class="va">lnr_glm</span>,</span>
<span>     rf <span class="op">=</span> <span class="va">lnr_randomForest</span>,</span>
<span>     glmnet <span class="op">=</span> <span class="va">lnr_glmnet</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># more learners are available, see ?learners</span></span>
<span></span>
<span><span class="va">sl_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  regression_formula <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">hp</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the output from super_learner is a prediction function:</span></span>
<span><span class="co"># here we are producing predictions based on a weighted combination of the</span></span>
<span><span class="co"># trained learners. </span></span>
<span><span class="fu">sl_model</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="do">##         Mazda RX4     Mazda RX4 Wag        Datsun 710    Hornet 4 Drive </span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="do">##          20.40028          20.40028          24.93155          20.40028 </span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="do">## Hornet Sportabout           Valiant </span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="do">##          16.86985          19.92227</span></span></code></pre></div>
<div class="section level3">
<h3 id="one-step-up-fancy-formula-features">One Step Up: Fancy Formula Features<a class="anchor" aria-label="anchor" href="#one-step-up-fancy-formula-features"></a>
</h3>
<p>Continuing with our <code>mtcars</code> example, suppose the user would really like to use random effects or similar types of fancy formula language features. One easy way to do so with <code><a href="reference/super_learner.html">nadir::super_learner</a></code> is using the following syntax:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>     glm <span class="op">=</span> <span class="va">lnr_glm</span>,</span>
<span>     rf <span class="op">=</span> <span class="va">lnr_randomForest</span>,</span>
<span>     glmnet <span class="op">=</span> <span class="va">lnr_glmnet</span>,</span>
<span>     lmer <span class="op">=</span> <span class="va">lnr_lmer</span>,</span>
<span>     gam <span class="op">=</span> <span class="va">lnr_gam</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">regression_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  .default <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">hp</span>,   <span class="co"># our first three learners use same formula</span></span>
<span>  lmer <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">cyl</span><span class="op">)</span> <span class="op">+</span> <span class="va">hp</span>, <span class="co"># both lme4::lmer and mgcv::gam have </span></span>
<span>  gam <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">hp</span><span class="op">)</span> <span class="op">+</span> <span class="va">cyl</span>      <span class="co"># specialized formula syntax</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># fit a super_learner</span></span>
<span><span class="va">sl_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  regression_formulas <span class="op">=</span> <span class="va">regression_formulas</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu">sl_model</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">##         Mazda RX4     Mazda RX4 Wag        Datsun 710    Hornet 4 Drive </span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="do">##          20.33819          20.33819          24.94327          20.33819 </span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="do">## Hornet Sportabout           Valiant </span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="do">##          16.87255          19.99762</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-should-we-assess-performance-of-nadirsuper_learner">How should we assess performance of <code>nadir::super_learner()</code>?<a class="anchor" aria-label="anchor" href="#how-should-we-assess-performance-of-nadirsuper_learner"></a>
</h3>
<p>To put the learners and the super learner algorithm on a level playing field, it’s important that learners and super learner both be evaluated on <em>held-out validation/test data</em> that the algorithms have not seen before.</p>
<p>Using the <code>verbose = TRUE</code> output from <code><a href="reference/super_learner.html">nadir::super_learner()</a></code>, we can call <code><a href="reference/compare_learners.html">compare_learners()</a></code> to see the mean-squared-error (MSE) on the held-out data, also called CV-MSE, for each of the candidate learners specified.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct our super learner with verbose = TRUE</span></span>
<span><span class="va">sl_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  regression_formulas <span class="op">=</span> <span class="va">regression_formulas</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="reference/compare_learners.html">compare_learners</a></span><span class="op">(</span><span class="va">sl_model</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="do">## The default in nadir::compare_learners is to use CV-MSE for comparing learners.</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="do">## Other metrics can be set using the metric argument to compare_learners.</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="do">## # A tibble: 1 × 5</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="do">##     glm    rf glmnet  lmer   gam</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="do">##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="do">## 1  12.0  11.0   11.9  12.2  13.2</span></span></code></pre></div>
<p>Now how should we go about getting the CV-MSE from a super learned model? We will have to <a href="https://en.wikipedia.org/wiki/Currying" class="external-link"><em>curry</em></a> our super learner into a function that only takes in data (with all of its additional specification built into it) and which returns a prediction function (i.e., a closure).</p>
<p>Technical aside: Why should we “have to” curry this function? Well, to perform cross-validation on <code><a href="reference/super_learner.html">super_learner()</a></code>, behind the scenes, we’re going to want to split the data into training/validation sets and apply the same <code><a href="reference/super_learner.html">super_learner()</a></code> to each of the training sets, producing a prediction-closure from each, so that we can predict from them onto the held-out validation data. From that perspective, we basically want a function that only takes in one input (training data) and spits out the relevant prediction function (closure).</p>
<p>Don’t let all this complicated language scare you; it’s fairly straightforward. Essentially you just need to wrap your super learner specification inside <code>sl_closure &lt;- function(data) { ... }</code>, make sure you specify <code>data = data</code> inside the inner <code><a href="reference/super_learner.html">super_learner()</a></code> call, and you’re done.</p>
<p>The return value from such a function is a closure is because what <code><a href="reference/super_learner.html">super_learner()</a></code> returns is already a closure that eats in <code>newdata</code> and returns predictions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_closure_mtcars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">nadir</span><span class="fu">::</span><span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  regression_formulas <span class="op">=</span> <span class="va">regression_formulas</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/cv_super_learner.html">cv_super_learner</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mtcars</span>, <span class="va">sl_closure_mtcars</span>, </span>
<span>                 y_variable <span class="op">=</span> <span class="st">'mpg'</span>,</span>
<span>                 n_folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">cv_mse</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="do">## [1] 10.00147</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># iris example ---</span></span>
<span><span class="va">sl_model_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">iris</span>,</span>
<span>  regression_formula <span class="op">=</span> <span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="reference/compare_learners.html">compare_learners</a></span><span class="op">(</span><span class="va">sl_model_iris</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="do">## The default in nadir::compare_learners is to use CV-MSE for comparing learners.</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="do">## Other metrics can be set using the metric argument to compare_learners.</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="do">## # A tibble: 1 × 3</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="do">##     glm    rf glmnet</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="do">##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="do">## 1 0.101 0.139  0.208</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_closure_iris</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">nadir</span><span class="fu">::</span><span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  regression_formula <span class="op">=</span> <span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span> <span class="op">+</span> <span class="va">Petal.Width</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">learners</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="reference/cv_super_learner.html">cv_super_learner</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris</span>, <span class="va">sl_closure_iris</span>, y_variable <span class="op">=</span> <span class="st">'Sepal.Length'</span><span class="op">)</span><span class="op">$</span><span class="va">cv_mse</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">## [1] 0.1009702</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-about-model-hyperparameters-or-extra-arguments">What about model hyperparameters or extra arguments?<a class="anchor" aria-label="anchor" href="#what-about-model-hyperparameters-or-extra-arguments"></a>
</h3>
<p>Model hyperparameters are easy to handle in <a href="https://ctesta01.github.io/nadir/">nadir</a>. Two easy solutions are available to users:</p>
<ul>
<li>
<code><a href="reference/super_learner.html">nadir::super_learner()</a></code> has an <code>extra_learner_args</code> parameter that can be passed a list of extra arguments for each learner.</li>
<li>Users can always build new learners (which allows for building in the hyperparameter specification), and using the <code>...</code> syntax, it’s easy to build new learners from the learners already provided by <a href="https://ctesta01.github.io/nadir/">nadir</a>.</li>
</ul>
<p>Here’s some examples showing each approach.</p>
<div class="section level4">
<h4 id="using-extra_learner_args">Using <code>extra_learner_args</code>:<a class="anchor" aria-label="anchor" href="#using-extra_learner_args"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># when using extra_learner_args, it's totally okay to use the </span></span>
<span><span class="co"># same learner multiple times as long as their hyperparameters differ.</span></span>
<span></span>
<span><span class="va">sl_model</span> <span class="op">&lt;-</span> <span class="fu">nadir</span><span class="fu">::</span><span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  regression_formula <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  learners <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    glmnet0 <span class="op">=</span> <span class="va">lnr_glmnet</span>,</span>
<span>    glmnet1 <span class="op">=</span> <span class="va">lnr_glmnet</span>,</span>
<span>    glmnet2 <span class="op">=</span> <span class="va">lnr_glmnet</span>,</span>
<span>    rf0 <span class="op">=</span> <span class="va">lnr_randomForest</span>,</span>
<span>    rf1 <span class="op">=</span> <span class="va">lnr_randomForest</span>,</span>
<span>    rf2 <span class="op">=</span> <span class="va">lnr_randomForest</span></span>
<span>    <span class="op">)</span>,</span>
<span>  extra_learner_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    glmnet0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>    glmnet1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    glmnet2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    rf0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntree <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>    rf1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntree <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>    rf2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ntree <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/compare_learners.html">compare_learners</a></span><span class="op">(</span><span class="va">sl_model</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## The default in nadir::compare_learners is to use CV-MSE for comparing learners.</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="do">## Other metrics can be set using the metric argument to compare_learners.</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="do">## # A tibble: 1 × 6</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="do">##   glmnet0 glmnet1 glmnet2   rf0   rf1   rf2</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="do">##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="do">## 1    10.3    6.85    8.09  5.81  6.45  5.98</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="building-new-learners-programmatically">Building New Learners Programmatically<a class="anchor" aria-label="anchor" href="#building-new-learners-programmatically"></a>
</h4>
<p>When does it make more sense to build new learners with the hyperparameters built into them rather than using the <code>extra_learner_args</code> parameter?</p>
<p>One instance when building new learners may make sense is when the user would like to produce a large number of hyperparameterized learners programmatically, for example over a grid of hyperparameter values. Below we show such an example for a 1-d grid of hyperparameters with <code>glmnet</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># produce a "grid" of glmnet learners with lambda set to </span></span>
<span><span class="co"># exp(-1 to 1 in steps of .1)</span></span>
<span><span class="va">hyperparameterized_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">{</span> </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">regression_formula</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">lnr_glmnet</span><span class="op">(</span><span class="va">data</span>, <span class="va">regression_formula</span>, lambda <span class="op">=</span> <span class="va">lambda</span>, <span class="va">...</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># give them names because nadir::super_learner requires that the </span></span>
<span><span class="co"># learners argument be named.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hyperparameterized_learners</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'glmnet'</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hyperparameterized_learners</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit the super_learner with 20 glmnets with different lambdas</span></span>
<span><span class="va">sl_model_glmnet</span> <span class="op">&lt;-</span> <span class="fu">nadir</span><span class="fu">::</span><span class="fu"><a href="reference/super_learner.html">super_learner</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  learners <span class="op">=</span> <span class="va">hyperparameterized_learners</span>,</span>
<span>  regression_formula <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/compare_learners.html">compare_learners</a></span><span class="op">(</span><span class="va">sl_model_glmnet</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="do">## The default in nadir::compare_learners is to use CV-MSE for comparing learners.</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="do">## Other metrics can be set using the metric argument to compare_learners.</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="do">## # A tibble: 1 × 21</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="do">##   glmnet1 glmnet2 glmnet3 glmnet4 glmnet5 glmnet6 glmnet7 glmnet8 glmnet9</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="do">##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="do">## 1    9.31    9.26    9.26    9.28    9.35    9.46    9.63    9.77    9.93</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="do">## # ℹ 12 more variables: glmnet10 &lt;dbl&gt;, glmnet11 &lt;dbl&gt;, glmnet12 &lt;dbl&gt;,</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="do">## #   glmnet13 &lt;dbl&gt;, glmnet14 &lt;dbl&gt;, glmnet15 &lt;dbl&gt;, glmnet16 &lt;dbl&gt;,</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="do">## #   glmnet17 &lt;dbl&gt;, glmnet18 &lt;dbl&gt;, glmnet19 &lt;dbl&gt;, glmnet20 &lt;dbl&gt;,</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="do">## #   glmnet21 &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="coming-down-the-pipe">Coming Down the Pipe<a class="anchor" aria-label="anchor" href="#coming-down-the-pipe"></a>
</h2>
<ul>
<li>Automated tests that try to ensure validity/correctness of the implementation!</li>
<li>Reworking some of the internals to use
<ul>
<li>
<a href="https://future.futureverse.org" class="external-link">future</a> and <a href="https://future.apply.futureverse.org" class="external-link">future.apply</a>
</li>
<li><a href="https://tlverse.org/origami/" class="external-link">origami</a></li>
</ul>
</li>
<li>Hopefully a <code>pkgdown</code> website and more vignettes soon.</li>
</ul>
</div>
</div>


  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nadir</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Christian Testa <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christian Testa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
