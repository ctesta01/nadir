<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Cross Validation Training/Validation Splits with Characters/Factor Columns — cv_character_and_factors_schema • nadir</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cross Validation Training/Validation Splits with Characters/Factor Columns — cv_character_and_factors_schema"><meta name="description" content='Designed to handle cross-validation on models like randomForest, ranger,
glmnet, etc., where the model matrix of newdata must match eactly the model
matrix of the training dataset, this function intends to answer the need "The
training datasets need to have every level of every discrete-type column that
appears in the data."'><meta property="og:description" content='Designed to handle cross-validation on models like randomForest, ranger,
glmnet, etc., where the model matrix of newdata must match eactly the model
matrix of the training dataset, this function intends to answer the need "The
training datasets need to have every level of every discrete-type column that
appears in the data."'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nadir</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/comparison_to_SuperLearner.html">comparison_to_SuperLearner</a></li>
    <li><a class="dropdown-item" href="../articles/guidance_for_developers.html">guidance_for_developers</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cross Validation Training/Validation Splits with Characters/Factor Columns</h1>

      <div class="d-none name"><code>cv_character_and_factors_schema.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Designed to handle cross-validation on models like randomForest, ranger,
glmnet, etc., where the model matrix of newdata must match eactly the model
matrix of the training dataset, this function intends to answer the need "The
training datasets need to have every level of every discrete-type column that
appears in the data."</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cv_character_and_factors_schema</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  n_folds <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  cv_sl_mode <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  check_validation_datasets_too <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data to use in training a `super_learner`.</p></dd>


<dt id="arg-n-folds">n_folds<a class="anchor" aria-label="anchor" href="#arg-n-folds"></a></dt>
<dd><p>The number of cross-validation folds to use in constructing the `super_learner`.</p></dd>


<dt id="arg-cv-sl-mode">cv_sl_mode<a class="anchor" aria-label="anchor" href="#arg-cv-sl-mode"></a></dt>
<dd><p>A binary (default: TRUE) indicator for if the output
training/validation data lists will be used inside another `super_learner`
call. If so, then the training data needs to have every level appear at
least twice so that the data can be put into further training/validation
splits.</p></dd>


<dt id="arg-check-validation-datasets-too">check_validation_datasets_too<a class="anchor" aria-label="anchor" href="#arg-check-validation-datasets-too"></a></dt>
<dd><p>Enforce that the validation datasets
produced also have every level of every character / factor type column
present. This is particularly useful for learners like `glmnet` which
require that the `newx` have the exact same shape/structure as the training
data, down to binary indicators for every level that appears.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The fundamental idea is to check if the unique levels of character and/or factor
columns are represented in every training dataset.</p>
<p>Above and beyond this, this function is designed to support cv_super_learner,
which inherently involves two layers of cross-validation.  As a result, more stringent
conditions are specified when the `cv_sl_mode` is enabled.  For convenience this
mode is enabled by default</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">palmerpenguins</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">training_validation_splits</span> <span class="op">&lt;-</span> <span class="fu">cv_character_and_factors_schema</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># we can see the population breakdown across all the training</span></span></span>
<span class="r-in"><span><span class="co"># splits:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">training_validation_splits</span><span class="op">$</span><span class="va">training_data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># notably, none of them are empty! this is crucial for certain</span></span></span>
<span class="r-in"><span><span class="co"># types of learning algorithms that must see all levels appear in the</span></span></span>
<span class="r-in"><span><span class="co"># training data, like random forests.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># certain models like glmnet require that the prediction dataset</span></span></span>
<span class="r-in"><span><span class="co"># newx have the _exact_ same shape as the training data, so it</span></span></span>
<span class="r-in"><span><span class="co"># can be important that every level appears in the validation data</span></span></span>
<span class="r-in"><span><span class="co"># as well.  check that by looking into these types of tables:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">training_validation_splits</span><span class="op">$</span><span class="va">validation_data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if you don't need this level of stringency, but you just want</span></span></span>
<span class="r-in"><span><span class="co"># to make cv_splits where every level appears in the training_data,</span></span></span>
<span class="r-in"><span><span class="co"># you can do so using the check_validation_datasets_too = FALSE</span></span></span>
<span class="r-in"><span><span class="co"># argument.</span></span></span>
<span class="r-in"><span><span class="va">penguins_small</span> <span class="op">&lt;-</span> <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">154</span><span class="op">:</span><span class="fl">156</span>, <span class="fl">277</span><span class="op">:</span><span class="fl">279</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">penguins_small</span> <span class="op">&lt;-</span> <span class="va">penguins_small</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">penguins_small</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">training_validation_splits</span> <span class="op">&lt;-</span> <span class="fu">cv_character_and_factors_schema</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">penguins_small</span>,</span></span>
<span class="r-in"><span>  cv_sl_mode <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  n_folds <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  check_validation_datasets_too <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">training_validation_splits</span><span class="op">$</span><span class="va">training_data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now you can see plenty of non-appearing levels in the validation data:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">training_validation_splits</span><span class="op">$</span><span class="va">validation_data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christian Testa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

